    if st.session_state.clicked_metric:
        col1, col2 = st.columns([3, 1])
        with col1:
            st.success(f"âœ¨ **Filtered View:** {st.session_state.clicked_metric}")
        with col2:
            if st.button("ğŸ”„ Reset Filter", use_container_width=True):
                st.session_state.selected_filter = 'All'
                st.session_state.clicked_metric = None
                st.rerun()
    
    filtered = df.copy()
    if st.session_state.selected_filter == 'At Risk':
        filtered = filtered[filtered['anomaly_flag'] == 'At Risk']
    elif st.session_state.selected_filter == 'Active':
        filtered = filtered[filtered['anomaly_flag'] == 'Active']
    elif st.session_state.selected_filter == 'Below Threshold':
        filtered = filtered[filtered['custom_risk'] == True]
    elif st.session_state.selected_filter == 'Above Average':
        filtered = filtered[filtered['engagement_score'] >= avg_score]
    
    filtered = filtered[filtered['engagement_score'] >= min_score]
    if search_id:
        filtered = filtered[filtered['student_id'].astype(str).str.contains(search_id, case=False)]
    filtered = filtered.sort_values('engagement_score', ascending=False)
    
    # Polished info box
    col1, col2, col3 = st.columns([2, 2, 1])
    with col1:
        st.info(f"ğŸ“Š **Showing {len(filtered)} of {len(df)} students**")
    with col2:
        percentage = (len(filtered)/len(df)*100)
        st.info(f"ğŸ“ˆ **{percentage:.1f}% of total data**")
    with col3:
        if len(filtered) > 0:
            st.success("âœ… **Data Ready**")
        else:
            st.warning("âš ï¸ **No Data**")
